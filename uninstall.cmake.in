# The install manifest is generated by 'cmake --install' in the build directory
set(MANIFEST "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")

if(NOT EXISTS "${MANIFEST}")
  message(FATAL_ERROR "Cannot find install manifest: \"${MANIFEST}\" - Run 'cmake --install .' first?")
endif()

message(STATUS "Uninstalling files listed in ${MANIFEST}...")

file(STRINGS "${MANIFEST}" files_to_uninstall)

foreach(file ${files_to_uninstall})
  # The manifest contains absolute paths based on CMAKE_INSTALL_PREFIX at install time
  message(STATUS "Removing: \"${file}\"")
  if(EXISTS "${file}")
    execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${file}"
                    RESULT_VARIABLE rm_retval)
    if(NOT rm_retval EQUAL 0)
      message(FATAL_ERROR "Failed to remove \"${file}\"")
    # Optionally try removing directories if they become empty, more complex:
    # elseif(IS_DIRECTORY "${file}")
    #   execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${file}" RESULT_VARIABLE rm_retval)
    #   # Check retval etc.
    endif()
  else()
    message(STATUS "File/directory not found (already removed?): \"${file}\"")
  endif()
endforeach()

message(STATUS "CMake uninstall script finished.")
